*** ActivityStack.smali	2016-01-12 21:05:57.972752994 +0800
--- ActivityStack.smali	2016-01-12 21:04:57.507546584 +0800
***************
*** 3681,3686 ****
      goto :goto_0
  
      :cond_6
      iget-object v5, p1, Lcom/android/server/am/ActivityRecord;->info:Landroid/content/pm/ActivityInfo;
  
      invoke-virtual {v5}, Landroid/content/pm/ActivityInfo;->getRealConfigChanged()I
--- 3755,3773 ----
      goto :goto_0
  
      :cond_6
+     iget-object v5, p1, Lcom/android/server/am/ActivityRecord;->packageName:Ljava/lang/String;
+ 
+     invoke-static {v5, v0, v2, v1}, Landroid/app/MiuiThemeHelper;->canKeepActivityAlive(Ljava/lang/String;ILandroid/content/res/Configuration;Landroid/content/res/Configuration;)Z
+ 
+     move-result v5
+ 
+     if-eqz v5, :cond_miui_0
+ 
+     const/4 v5, 0x1
+ 
+     return v5
+ 
+     :cond_miui_0
      iget-object v5, p1, Lcom/android/server/am/ActivityRecord;->info:Landroid/content/pm/ActivityInfo;
  
      invoke-virtual {v5}, Landroid/content/pm/ActivityInfo;->getRealConfigChanged()I
***************
*** 6310,6315 ****
      :cond_2
      iget-object v9, p0, Lcom/android/server/am/ActivityStack;->mTaskHistory:Ljava/util/ArrayList;
  
      invoke-virtual {v9, v8}, Ljava/util/ArrayList;->remove(Ljava/lang/Object;)Z
  
      iget-object v9, p0, Lcom/android/server/am/ActivityStack;->mTaskHistory:Ljava/util/ArrayList;
--- 6397,6406 ----
      :cond_2
      iget-object v9, p0, Lcom/android/server/am/ActivityStack;->mTaskHistory:Ljava/util/ArrayList;
  
+     invoke-static {p0, v9, v8}, Lcom/android/server/am/ActivityStackInjector;->transferOnTopOfHomeForMoveTaskToBackLocked(Lcom/android/server/am/ActivityStack;Ljava/util/ArrayList;Lcom/android/server/am/TaskRecord;)V
+ 
+     iget-object v9, p0, Lcom/android/server/am/ActivityStack;->mTaskHistory:Ljava/util/ArrayList;
+ 
      invoke-virtual {v9, v8}, Ljava/util/ArrayList;->remove(Ljava/lang/Object;)Z
  
      iget-object v9, p0, Lcom/android/server/am/ActivityStack;->mTaskHistory:Ljava/util/ArrayList;
***************
*** 11314,11319 ****
      if-eq v4, v6, :cond_4
  
      :cond_3
      invoke-virtual {p0, v3}, Lcom/android/server/am/ActivityStack;->screenshotActivities(Lcom/android/server/am/ActivityRecord;)Landroid/graphics/Bitmap;
  
      move-result-object v4
--- 11409,11416 ----
      if-eq v4, v6, :cond_4
  
      :cond_3
+     invoke-direct {p0, v3}, Lcom/android/server/am/ActivityStack;->startPausingLocked_Middle(Lcom/android/server/am/ActivityRecord;)V
+ 
      invoke-virtual {p0, v3}, Lcom/android/server/am/ActivityStack;->screenshotActivities(Lcom/android/server/am/ActivityRecord;)Landroid/graphics/Bitmap;
  
      move-result-object v4
